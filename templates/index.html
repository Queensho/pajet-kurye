<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pajet Operasyon</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --green: #22c55e; --yellow: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; }
        #map { height: 280px; width: 100%; filter: brightness(0.8) contrast(1.2); }
        .container { padding: 15px; max-width: 600px; margin: auto; }
        .section-title { font-size: 1.1rem; color: var(--green); display: flex; align-items: center; gap: 8px; margin: 20px 0 10px; }
        .card { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }
        .info b { font-size: 1rem; display: block; }
        .info small { color: #94a3b8; font-size: 0.8rem; }
        .badge { padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; margin-top: 5px; display: inline-block; }
        .badge-active { background: rgba(34,229,94,0.15); color: var(--green); }
        .badge-wait { background: rgba(245,158,11,0.15); color: var(--yellow); }
        .stats { text-align: right; }
        .stats div { font-size: 1.8rem; font-weight: 800; color: var(--green); }
        .btn { padding: 10px; border-radius: 10px; border: none; color: white; font-weight: bold; cursor: pointer; width: 100%; margin-top: 8px; }
        .btn-ok { background: var(--green); } .btn-del { background: #ef4444; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="container">
        <div class="section-title"><i class="fa-solid fa-motorcycle"></i> Aktif Kuryeler</div>
        {% for kurye in kuryeler %}
        <div class="card">
            <div style="flex:2">
                <b>{{ kurye['isim'] }}</b>
                <small>{{ kurye['plaka'] }}</small><br>
                <div class="badge {% if kurye['durum'] == 'Aktif' %}badge-active{% else %}badge-wait{% endif %}">{{ kurye['durum'] }}</div>
                <form action="/islem/{{ kurye['id'] }}" method="POST">
                    {% if kurye['durum'] != 'Aktif' %}<button name="aksiyon" value="onayla" class="btn btn-ok">ONAYLA</button>{% endif %}
                    <button name="aksiyon" value="sil" class="btn btn-del">Sƒ∞L</button>
                </form>
            </div>
            <div class="stats">
                <div>{{ kurye['paket_sayisi'] or 0 }}</div>
                <small style="color:#94a3b8">PAKET</small>
            </div>
        </div>
        {% endfor %}

        <div class="section-title"><i class="fa-solid fa-box"></i> G√∂nderi Havuzu</div>
        {% for is in gonderiler %}
        <div class="card" style="border-left: 4px solid var(--yellow);">
            <div style="flex:2">
                <b>üìç {{ is['alici_adres'] }}</b>
                <small>üèÅ {{ is['gidilecek_yer'] }}</small><br>
                <small>üìû {{ is['tel'] }}</small>
            </div>
            <div class="stats">
                <div style="color:var(--yellow)">{{ is['fiyat'] }}‚Ç∫</div>
                <button class="badge" style="background:var(--yellow); color:black; border:none; cursor:pointer">ATA</button>
            </div>
        </div>
        {% endfor %}
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', {zoomControl: false}).setView([41.0082, 28.9784], 12);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        {% for kurye in kuryeler %}{% if kurye['lat'] %}
            L.marker([{{ kurye['lat'] }}, {{ kurye['lng'] }}]).addTo(map);
        {% endif %}{% endfor %}
    </script>
</body>
</html>
