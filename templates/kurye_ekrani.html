<!DOCTYPE html>
<html>
<head>
    <title>BBK Kurye Havuzu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        /* BBK SarÄ±-Siyah TasarÄ±mÄ± */
        body { font-family: sans-serif; background: #f0f0f0; margin: 0; padding: 20px; }
        .order-card { background: white; padding: 20px; border-radius: 15px; border-left: 8px solid #FFD54F; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-kap { background: #212121; color: white; padding: 10px 20px; border: none; border-radius: 8px; float: right; cursor: pointer; }
    </style>
</head>
<body>
    <h2 style="color: #212121;">ğŸš€ CanlÄ± Ä°ÅŸ Havuzu</h2>
    <div id="havuz-listesi">
        {% for is in havuz %}
        <div class="order-card" id="is-{{ is['id'] }}">
            <b>ğŸ“ Nereden:</b> {{ is['adres_al'] }} <br>
            <b>ğŸ Nereye:</b> {{ is['adres_ver'] }} <br>
            <span style="font-size: 20px; font-weight: bold;">{{ is['fiyat'] }} TL</span>
            <button class="btn-kap">KAP</button>
        </div>
        {% endfor %}
    </div>

    <audio id="dutDut" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

    <script>
        var socket = io();
        var audio = document.getElementById("dutDut");

        // Sunucudan yeni paket sinyali gelince Ã§alÄ±ÅŸÄ±r
        socket.on('yeni_paket_dustu', function(data) {
            // 1. Sesi Ã§al (DÃœT DÃœT!)
            audio.play();

            // 2. Ekrana yeni iÅŸ kartÄ±nÄ± ekle
            var yeniKart = `
                <div class="order-card" id="is-${data.id}" style="border-left-color: #ff0000; animation: bounce 0.5s;">
                    <b>ğŸ“ Nereden:</b> ${data.adres_al} <br>
                    <b>ğŸ Nereye:</b> ${data.adres_ver} <br>
                    <span style="font-size: 20px; font-weight: bold;">${data.fiyat} TL</span>
                    <button class="btn-kap">KAP</button>
                </div>`;
            
            document.getElementById('havuz-listesi').insertAdjacentHTML('afterbegin', yeniKart);
            
            // 3. Bildirim GÃ¶ster
            alert("Yeni Ä°ÅŸ DÃ¼ÅŸtÃ¼! " + data.fiyat + " TL");
        });
    </script>
</body>
</html>
