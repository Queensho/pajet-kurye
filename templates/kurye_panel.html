<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBK Kurye Havuzu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; margin: 0; padding: 15px; }
        .header { background: #FFD54F; padding: 20px; margin: -15px -15px 20px; font-weight: bold; font-size: 1.2rem; }
        .order-card { background: white; padding: 20px; border-radius: 15px; border-left: 8px solid #FFD54F; margin-bottom: 12px; transition: 0.3s; }
        .btn-kap { background: #212121; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; float: right; }
        @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.9); } }
    </style>
</head>
<body>
    <div class="header">ğŸš€ CanlÄ± Ä°ÅŸ Havuzu</div>
    <div id="havuz-listesi">
        {% for is in havuz %}
        <div class="order-card" id="is-{{ is['id'] }}">
            <b>ğŸ“ AlÄ±m:</b> {{ is['adres_al'] }}<br>
            <b>ğŸ Teslim:</b> {{ is['adres_ver'] }}<br><br>
            <span style="font-size: 1.3rem; font-weight: 800;">{{ is['fiyat'] }} TL</span>
            <button onclick="isiKap({{ is['id'] }})" class="btn-kap">KAP</button>
            <div style="clear:both;"></div>
        </div>
        {% endfor %}
    </div>

    <audio id="dutDut" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

    <script>
        var socket = io();
        var audio = document.getElementById("dutDut");

        socket.on('yeni_paket_dustu', function(data) {
            audio.play();
            var html = `<div class="order-card" id="is-${data.id}">
                <b>ğŸ“ AlÄ±m:</b> ${data.adres_al}<br><b>ğŸ Teslim:</b> ${data.adres_ver}<br><br>
                <span style="font-size: 1.3rem; font-weight: 800;">${data.fiyat} TL</span>
                <button onclick="isiKap(${data.id})" class="btn-kap">KAP</button>
                <div style="clear:both;"></div></div>`;
            document.getElementById('havuz-listesi').insertAdjacentHTML('afterbegin', html);
        });

        socket.on('is_sil_sinyali', function(data) {
            var el = document.getElementById('is-' + data.id);
            if(el) { el.style.animation = "fadeOut 0.5s forwards"; setTimeout(() => el.remove(), 500); }
        });

        function isiKap(id) {
            fetch('/is_al/' + id, { method: 'POST' })
            .then(res => res.json()).then(data => { alert(data.message); });
        }
    </script>
</body>
</html>
